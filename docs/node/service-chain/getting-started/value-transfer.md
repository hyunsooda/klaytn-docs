This section will explain how to enable ERC-20 value transfer between Baobab network and your service chain with the provided test code.
You will add KLAY to the operator account and deploy bridge and ERC-20 contracts.
Then you will register the contract address on SCN. And you will test an ERC-20 value transferring.


## Prerequisites <a id="prerequisites"></a>
- We assume that you installed the service chain, and connected the service chain to the Baobab EN ([link](en-scn-connection.md)).
- Clone the [cross-chain-transfer-example repository](https://github.com/klaytn/sc-vt).
- Install `Node.js` (v14) and `npm` ([How to install](https://nodejs.org/en/download/package-manager/))
    - This example leverages two packages, axios and caver-js, which both support v14.


## ERC-20 Token Transfer (one-step) <a id="erc-20-token-transfer-onestep"></a>

### Step 1: Add KLAY to the operator accounts. <a id="step-1-add-klay-to-the-operator-accounts"></a>
Connect to the SCN and check the account addresses by executing `subbridge.parentOperator` and `subbridge.childOperator`.
```
$ kscn attach --datadir ~/data
> subbridge.childOperator
"0x10221f7f9355017cd0c11444e7eecb99621bacce"
> subbridge.parentOperator
"0x3ce216beeafc62d20547376396e89528e1d778ca"
```

Create a test account on a [Baobab Wallet](https://baobab.wallet.klaytn.com/) and get test KLAY from the faucet. Then send 1 KLAY to the `parentOperator`. `childOperator` has to get KLAY from the test account generated by `homi` ([Refer to EN Setup and SCN Connection Guide](en-scn-connection.md)).

```
$ kscn account import ~/homi-output/keys_test/testkey1
Your new account is locked with a password. Please give a password. Do not forget this password.
Passphrase:
Repeat passphrase:
Address: {80119c31cdae67c42c8296929bb4f89b2a52cec4}
```
```
$ kscn attach --datadir ~/data
> personal.unlockAccount("80119c31cdae67c42c8296929bb4f89b2a52cec4")
Unlock account 80119c31cdae67c42c8296929bb4f89b2a52cec4
Passphrase:
True
> klay.sendTransaction({from:"80119c31cdae67c42c8296929bb4f89b2a52cec4", to:subbridge.childOperator, value: web3.toPeb(1000, "KLAY")})
"0x84caab84ebf0c4bb4ecf0a7849f1de3e479f1863a95f70c51047a7ca7bc64b33"
```
Check if the operator accounts have enough balance.
```
> klay.getBalance(subbridge.childOperator)
1e+21
> klay.getBalance(subbridge.parentOperator)
1e+18
```

### Step 2: Deploy Contracts <a id="step-2-deploy-contracts"></a>
- Connect to the SCN and prepare the node environment for contract deployment.
- Clone the [cross-chain-transfer-example repository](https://github.com/klaytn/sc-vt).

In this step, we would deploy both bridge contract and token contract in parent chain as well as child chain.
Token contracts are for mint/transfer test and bridge contracts are used for the listen/handle value transfer request.

```bash
$ git clone https://github.com/klaytn/sc-vt
$ cd sc-vt
$ npm install
$ cd erc20
```

On a text editor, edit the `bridge_info.json` as below.
- Replace `url` in the `child` section (SCN node on ServiceChain network) with your SCN node IP and the proper port number from `RPC_PORT` in `kscnd.conf`.
- Replace `key` with `testkey1` that was generated by `homi`.
- Set `operator` to the `subbridge.childOperator` address that we examined in the previous step.
- Replace `url` in the `parent` section (EN node on Baobab network) with your EN node IP and the proper port number from `RPC_PORT` in `kend.conf`.
- Replace `key` with the private key of the test account created from [Baobab Wallet](https://baobab.wallet.klaytn.com/) in the previous step.
- Set `operator` as the `subbridge.parentOperator` of the previous step.

```
{
     "child" : {
         "url": "http://192.168.0.1:7551",
         "key": "0x66cb283353589a10866b58d388e9d956e5a9c873a8c78fa4411d460c19c494ea",
         "operator": "0x10221f7f9355017cd0c11444e7eecb99621bacce"
     },
     "parent" : {
         "url": "http://192.168.0.5:8551",
         "key": "0x26f4b5ac42ceabcfd3b23a991fdbfc792d10ce700a99582fdf9185a8f163b790",
         "operator": "0x3ce216beeafc62d20547376396e89528e1d778ca"
     }
 }
```

- Add `subbridge` to `RPC_API` of `kscnd.conf`. This setting is required for sending an RPC call from the deployment script.
```
RPC_API="klay,subbridge"
```

Perform the token deployment by running the command `node erc20-deploy.js`. This script deploys both the bridge contract and the token contract, and sends RPC calls to register and subscribe the token contract to the bridge contract.
```
$ node erc20-deploy.js
```

You can see the required initialization APIs in the deployment source code. If you want to register them manually, you can type the API calls in your attached console.
Do not run these commands if you ran `node erc20-deploy.js` since the script already called those APIs (It causes a duplicate error).
```
> subbridge.registerBridge("0xCHILD_BRIDGE_ADDR", "0xPARENT_BRIDGE_ADDR")
null
> subbridge.subscribeBridge("0xCHILD_BRIDGE_ADDR", "0xPARENT_BRIDGE_ADDR")
null
> subbridge.registerToken("0xCHILD_BRIDGE_ADDR", "0xPARENT_BRIDGE_ADDR", "0xCHILD_TOKEN_ADDR", "0XPARENT_TOKEN_ADDR")
null
```

### Step 3: Token transfer <a id="step-3-token-transfer"></a>
Perform token transfer with the command `node erc20-transfer-1step.js`.
```
$ node erc20-transfer-1step.js
------------------------- erc20-transfer-1step START -------------------------
alice balance: 0
requestValueTransfer..
alice balance: 100
------------------------- erc20-transfer-1step END -------------------------
```

Check if the result is `alice balance: 100`.

## ERC-20 Token Transfer (two-step) <a id="erc-20-token-transfer-twostep"></a>
Run erc20-transfer-2step.js for the two-step transfer example.
The two-step transfer consists of two function calls: (1) approve bridge contract first, and then (2) call the contract function(`requestERC20Transfer()`).
```
$ node erc20-transfer-2step.js
```

## ERC-20 Token Transfer via Compatible Token Contract (two-step) <a id="erc-20-token-transfer-compatiable"></a>
KIP7 and KIP17 standards are compatiable token standard with ERC20 and ERC721 standard. We can call `requestERCXXXTransfer()` and `requestKIPXXXTransfer()` functions from KIP7 token contract and ERC token contract, respectively.
Currently, the bridge contract, provided by Klaytn team supports only `requestERC20Transfer()` and `requestERC721Transfer()` for token trasnfer. The corresponding request functions for KIP7 and KIP17 would be supported soon.
The below command shows example of seding KIP7 token using ERC20 interface with `requestERC20Transfer()`.
```
$ node erc20-transfer-2step-kip7-interface.js
```

## ERC-721, KIP7, KIP17, KLAY Transfer <a id="erc-721-token-transfer"></a>
The workflow is same as above. `erc721`, `kip7`, `kip17`, and `klay` directories contain corresponding example source code.
